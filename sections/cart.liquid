{%- liquid
  assign free_shipping_threshold = section.settings.free_shipping_threshold | times: 100
-%}

<cart-section id="Cart-{{ section.id }}" data-section-id="{{ section.id }}">
  <div class="cart__container">
    {%- if cart.empty? -%}
      <div class="cart-empty">
        <div class="cart-empty__icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path></svg>
        </div>
        <h2 class="cart-empty__title">Votre panier est vide</h2>
        <p class="cart-empty__subtitle">Il semble que vous n'ayez encore rien ajouté. Parcourez nos collections pour trouver votre prochain coup de cœur.</p>
        <a href="{{ section.settings.continue_shopping_url | default: routes.all_products_collection_url }}" class="cart__button cart__button--primary">
          Continuer les achats
        </a>
      </div>
    {%- else -%}
      <div class="cart__header" id="CartHeader-{{ section.id }}">
        <h1 class="cart__title">Votre Panier</h1>
        {% if section.settings.show_continue_shopping %}
          <a href="{{ section.settings.continue_shopping_url | default: routes.all_products_collection_url }}" class="cart__continue-shopping">
            Continuer les achats
          </a>
        {% endif %}
      </div>

      <form action="{{ routes.cart_url }}" method="post" novalidate class="cart__form">
        <div class="cart__grid">
          <div class="cart__items-column" id="CartItems-{{ section.id }}">
            
            {% if free_shipping_threshold > 0 %}
              <div class="cart-shipping-bar">
                <p class="cart-shipping-bar__text">
                  {%- assign remaining = free_shipping_threshold | minus: cart.total_price -%}
                  {%- if remaining > 0 -%}
                    Plus que <span data-remaining-amount>{{ remaining | money }}</span> pour la livraison gratuite !
                  {%- else -%}
                    Félicitations ! Vous bénéficiez de la livraison gratuite.
                  {%- endif -%}
                </p>
                <div class="cart-shipping-bar__progress-bg">
                  {%- assign progress = cart.total_price | times: 100.0 | divided_by: free_shipping_threshold | at_most: 100 -%}
                  <div class="cart-shipping-bar__progress" style="width: {{ progress }}%;"></div>
                </div>
              </div>
            {% endif %}

            <div class="cart-items__header">
              <span class="cart-items__header-label">Produit</span>
              <span class="cart-items__header-label cart-items__header-label--center">Quantité</span>
              <span class="cart-items__header-label cart-items__header-label--right">Total</span>
            </div>
            
            <div class="cart-items__list">
              {%- for item in cart.items -%}
                <div class="cart-item" data-line-key="{{ item.key }}">
                  <div class="cart-item__image-wrapper">
                    <a href="{{ item.url }}">
                    {{ item.image | image_url: width: 240 | image_tag: alt: item.image.alt, loading: 'lazy' }}
                    </a>
                  </div>
                  <div class="cart-item__details">
                    <div class="cart-item__title-wrapper">
                        <a href="{{ item.url }}" class="cart-item__title">{{ item.product.title }}</a>
                        <a href="{{ routes.cart_change_url }}?id={{ item.key }}&quantity=0" class="cart-item__remove cart-item__remove--mobile" aria-label="Supprimer l'article">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16"><path d="M17 6H22V8H20V21C20 21.5523 19.5523 22 19 22H5C4.44772 22 4 21.5523 4 21V8H2V6H7V3C7 2.44772 7.44772 2 8 2H16C16.5523 2 17 2.44772 17 3V6ZM18 8H6V20H18V8Z"/></svg>
                        </a>
                    </div>
                    {%- unless item.product.has_only_default_variant -%}
                      <p class="cart-item__variant">{{ item.variant.title }}</p>
                    {%- endunless -%}
                    <div class="cart-item__details-bottom">
                      <quantity-selector class="cart__quantity-selector cart-item__quantity-selector--mobile">
                        <button type="button" class="cart__quantity-button" name="minus" aria-label="Diminuer la quantité">-</button>
                        <input type="number" class="cart__quantity-input" value="{{ item.quantity }}" min="0" data-line-key="{{ item.key }}" aria-label="Quantité">
                        <button type="button" class="cart__quantity-button" name="plus" aria-label="Augmenter la quantité">+</button>
                      </quantity-selector>
                      <span class="cart-item__price--mobile">{{ item.final_line_price | money }}</span>
                    </div>
                  </div>
                  <div class="cart-item__quantity">
                    <quantity-selector class="cart__quantity-selector">
                      <button type="button" class="cart__quantity-button" name="minus" aria-label="Diminuer la quantité">-</button>
                      <input type="number" class="cart__quantity-input" value="{{ item.quantity }}" min="0" data-line-key="{{ item.key }}" aria-label="Quantité">
                      <button type="button" class="cart__quantity-button" name="plus" aria-label="Augmenter la quantité">+</button>
                    </quantity-selector>
                  </div>
                  <div class="cart-item__line-price">
                    {% if item.original_line_price != item.final_line_price %}
                      <s class="cart-item__original-price">{{ item.original_line_price | money }}</s>
                    {% endif %}
                    <span>{{ item.final_line_price | money }}</span>
                  </div>
                  <a href="{{ routes.cart_change_url }}?id={{ item.key }}&quantity=0" class="cart-item__remove cart-item__remove--desktop" aria-label="Supprimer l'article">
                     <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18"><path d="M17 6H22V8H20V21C20 21.5523 19.5523 22 19 22H5C4.44772 22 4 21.5523 4 21V8H2V6H7V3C7 2.44772 7.44772 2 8 2H16C16.5523 2 17 2.44772 17 3V6ZM18 8H6V20H18V8Z"/></svg>
                  </a>
                </div>
              {%- endfor -%}
            </div>
          </div>

          <div class="cart__summary-column" id="CartSummary-{{ section.id }}">
            <div class="cart-summary">
              <h2 class="cart-summary__title">Récapitulatif</h2>
              <div class="cart-summary__row">
                <span>Sous-total</span>
                <span data-cart-subtotal>{{ cart.items_subtotal_price | money }}</span>
              </div>
              <div class="cart-summary__discounts" data-cart-discounts>
                {%- if cart.cart_level_discount_applications.size > 0 -%}
                  {% for discount_application in cart.cart_level_discount_applications %}
                    <div class="cart-summary__row cart-summary__row--discount">
                      <span>Réduction ({{ discount_application.title }})</span>
                      <span>-{{ discount_application.total_allocated_amount | money }}</span>
                    </div>
                  {% endfor %}
                {%- endif -%}
              </div>
              <div class="cart-summary__row">
                <span>Livraison</span>
                <span>Calculée à la prochaine étape</span>
              </div>
              <div class="cart-summary__divider"></div>
              <div class="cart-summary__row cart-summary__row--total">
                <strong>Total</strong>
                <strong data-cart-total>{{ cart.total_price | money }}</strong>
              </div>

              {% if section.settings.show_discount_field %}
                <div class="cart-discount">
                  <input type="text" name="discount" class="cart-discount__input" placeholder="Code de réduction" autocomplete="off" value="{{ cart.discount_applications.first.code }}">
                  <button type="button" class="cart-discount__button" aria-label="Appliquer le code">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M16.1716 10.9999L10.8076 5.63589L12.2218 4.22168L20 11.9999L12.2218 19.778L10.8076 18.3638L16.1716 12.9999H4V10.9999H16.1716Z"></path></svg>
                  </button>
                </div>
                <p class="cart-discount__message" style="display:none;"></p>
              {% endif %}

              {% if section.settings.show_cart_note %}
                <div class="cart-notes">
                  <label for="Cart-note-{{ section.id }}">Ajouter une note à votre commande</label>
                  <textarea name="note" id="Cart-note-{{ section.id }}" class="cart-notes__input" placeholder="Ajoutez une note ici...">{{ cart.note }}</textarea>
                </div>
              {% endif %}

              <div class="cart-summary__buttons">
                <button type="submit" name="checkout" class="cart__button cart__button--primary">
                  <span>Procéder au Paiement</span>
                  <svg class="cart__button-spinner" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>
                </button>
                {%- unless section.settings.hide_payment_badges -%}
                  <div class="cart__dynamic-checkout">
                    {{ content_for_additional_checkout_buttons }}
                  </div>
                {%- endunless -%}
              </div>
              <div class="cart-summary__secure-info">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="16" height="16"><path d="M18 8H17V6C17 3.23858 14.7614 1 12 1C9.23858 1 7 3.23858 7 6V8H6C4.89543 8 4 8.89543 4 10V20C4 21.1046 4.89543 22 6 22H18C19.1046 22 20 21.1046 20 20V10C20 8.89543 19.1046 8 18 8ZM9 6C9 4.34315 10.3431 3 12 3C13.6569 3 15 4.34315 15 6V8H9V6Z"></path></svg>
                <span>Transactions sécurisées</span>
              </div>
            </div>
          </div>
        </div>
      </form>
    {%- endif -%}
  </div>
</cart-section>

<script>
  if (!customElements.get('cart-section')) {
    customElements.define('cart-section', class CartSection extends HTMLElement {
      constructor() {
        super();
        this.sectionId = this.dataset.sectionId;
        this.debouncedUpdateLineItem = this.debounce((lineKey, quantity) => this.updateLineItem(lineKey, quantity), 350);
        this.debouncedUpdateCartNote = this.debounce(() => this.updateCartNote(), 800);
        this.bindElements();
        this.init();
      }

      bindElements() {
        this.cartNoteInput = this.querySelector(`#Cart-note-${this.sectionId}`);
        this.discountInput = this.querySelector('.cart-discount__input');
        this.discountButton = this.querySelector('.cart-discount__button');
        this.discountMessage = this.querySelector('.cart-discount__message');
        this.checkoutButton = this.querySelector('.cart__button--primary');
      }

      init() {
        this.addEventListener('click', this.handleClick.bind(this));
        this.addEventListener('input', this.handleInput.bind(this));
        if (this.discountButton) {
          this.discountButton.addEventListener('click', this.applyDiscountCode.bind(this));
        }
      }

      handleClick(event) {
        const target = event.target.closest('.cart__quantity-button, .cart-item__remove, .cart__button--primary');
        if (!target) return;

        if (target.matches('.cart__button--primary')) {
          this.handleCheckoutAnimation(event);
          return; // Let form submit
        }
        
        event.preventDefault();
        const lineItem = target.closest('.cart-item');

        if (target.matches('.cart__quantity-button') || target.matches('.cart-item__remove')) {
          if (!lineItem) return;
          const lineKey = lineItem.dataset.lineKey;
          let newQuantity;

          if (target.matches('.cart-item__remove')) {
            newQuantity = 0;
          } else {
            const quantityInput = target.parentElement.querySelector('.cart__quantity-input');
            const currentQuantity = parseInt(quantityInput.value, 10);
            newQuantity = target.name === 'plus' ? currentQuantity + 1 : Math.max(0, currentQuantity - 1);
          }
          if (typeof newQuantity !== 'undefined') this.debouncedUpdateLineItem(lineKey, newQuantity);
        }
      }
      
      handleInput(event) {
        const target = event.target;
        if (target.matches('.cart__quantity-input')) {
          const lineKey = target.dataset.lineKey;
          const quantity = parseInt(target.value, 10);
          if (!isNaN(quantity) && quantity >= 0) this.debouncedUpdateLineItem(lineKey, quantity);
        } else if (target.matches('.cart-notes__input')) {
          this.debouncedUpdateCartNote();
        }
      }
      
      handleCheckoutAnimation(event) {
        if(this.checkoutButton.classList.contains('is-loading')) {
          event.preventDefault();
          return;
        }
        this.checkoutButton.classList.add('is-loading');
      }

      updateLineItem(lineKey, quantity) {
        this.updateCartAPI({ updates: { [lineKey]: quantity } }, true);
      }

      updateCartNote() {
        if (!this.cartNoteInput) return;
        this.updateCartAPI({ note: this.cartNoteInput.value });
      }
      
      applyDiscountCode() {
        const code = this.discountInput.value.trim();
        if (!code) {
          this.displayMessage(this.discountMessage, 'Veuillez entrer un code.', false);
          return;
        }
        this.setLoading(true, this.discountButton);
        this.displayMessage(this.discountMessage, '', false);
        
        window.location.href = `${window.location.origin}/discount/${code}?redirect=/checkout`;
      }

      async updateCartAPI(body, renderAll = false) {
        this.setLoading(true, this);
        try {
          const response = await fetch('/cart/update.js', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
            body: JSON.stringify(body)
          });
          const state = await response.json();
          if (!response.ok) throw new Error(state.description || 'API Error');
          
          if (renderAll) {
            const freshState = await (await fetch(`?section_id=${this.sectionId}`)).text();
            this.renderSections(freshState);
          }
          return state;
        } catch (error) {
          console.error('Cart API Error:', error);
          this.displayMessage(this.discountMessage, 'Une erreur est survenue.', false);
        } finally {
          this.setLoading(false, this);
          if(this.discountButton) this.setLoading(false, this.discountButton);
        }
      }

      renderSections(html) {
        const newSectionHTML = new DOMParser().parseFromString(html, 'text/html');
        if (newSectionHTML.querySelector('.cart-empty')) {
           window.location.reload();
           return;
        }
        const newItemsHTML = newSectionHTML.getElementById(`CartItems-${this.sectionId}`).innerHTML;
        const newSummaryHTML = newSectionHTML.getElementById(`CartSummary-${this.sectionId}`).innerHTML;
        this.querySelector(`#CartItems-${this.sectionId}`).innerHTML = newItemsHTML;
        this.querySelector(`#CartSummary-${this.sectionId}`).innerHTML = newSummaryHTML;
        this.bindElements();
      }
      
      displayMessage(element, text, isSuccess) {
        if (!element) return;
        element.textContent = text;
        element.style.color = isSuccess ? 'green' : 'red';
        element.style.display = text ? 'block' : 'none';
      }

      setLoading(isLoading, element) {
        if (element) element.classList.toggle('is-loading', isLoading);
      }

      debounce(fn, wait) {
        let t;
        return (...args) => { clearTimeout(t); t = setTimeout(() => fn.apply(this, args), wait) };
      }
    });
  }
</script>

<style>
  @keyframes spin { 100% { transform: rotate(360deg); } }

  #Cart-{{ section.id }} {
    --accent-color: {{ section.settings.accent_color }};
    --accent-color-dark: {{ section.settings.accent_color | color_darken: 10 }};
    --text-color: {{ section.settings.text_color }};
    --bg-color: {{ section.settings.background_color }};
    --border-color: #e5e7eb;
    --font-heading: 'Anton', sans-serif;
    --font-body: 'Plus Jakarta Sans', sans-serif;
  }
  #Cart-{{ section.id }} .cart__container { max-width: 1320px; margin: 0 auto; padding: 20px; font-family: var(--font-body); color: var(--text-color); background-color: var(--bg-color); }
  #Cart-{{ section.id }}.is-loading, .is-loading { opacity: 0.7; pointer-events: none; }

  /* --- Design du Panier Vide --- */
  #Cart-{{ section.id }} .cart-empty { text-align: center; padding: 60px 20px; display: flex; flex-direction: column; align-items: center; justify-content: center; }
  #Cart-{{ section.id }} .cart-empty__icon { color: var(--text-color); opacity: 0.8; margin-bottom: 24px; }
  #Cart-{{ section.id }} .cart-empty__title { font-family: var(--font-heading); font-size: 2.5rem; letter-spacing: 1px; text-transform: uppercase; margin: 0 0 12px; }
  #Cart-{{ section.id }} .cart-empty__subtitle { font-size: 1rem; max-width: 450px; opacity: 0.7; margin: 0 0 32px; line-height: 1.5; }
  #Cart-{{ section.id }} .cart-empty .cart__button--primary { max-width: 300px; width: 100%; }
  
  /* Bouton Principal de Paiement */
  #Cart-{{ section.id }} .cart__button--primary {
    background-color: var(--accent-color);
    color: #fff;
    padding: 16px 24px;
    font-weight: 700;
    font-size: 1.1rem;
    letter-spacing: 1.2px;
    text-transform: uppercase;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.3s ease;
    width: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 12px;
    text-decoration: none;
  }
  #Cart-{{ section.id }} .cart__button--primary:hover { background-color: var(--accent-color-dark); }
  #Cart-{{ section.id }} .cart__button--primary.is-loading span { display: none; }
  #Cart-{{ section.id }} .cart__button-spinner { display: none; width: 20px; height: 20px; }
  #Cart-{{ section.id }} .cart__button--primary.is-loading .cart__button-spinner { display: block; animation: spin 1s linear infinite; }

  /* Champ de Réduction Intégré */
  #Cart-{{ section.id }} .cart-discount { position: relative; margin: 24px 0; }
  #Cart-{{ section.id }} .cart-discount__input { width: 100%; border: 1px solid var(--border-color); background-color: #fff; padding: 14px 50px 14px 16px; border-radius: 8px; font-size: 1rem; }
  #Cart-{{ section.id }} .cart-discount__button { position: absolute; right: 6px; top: 50%; transform: translateY(-50%); background-color: var(--accent-color); color: #fff; border: none; border-radius: 6px; width: 36px; height: 36px; display: flex; justify-content: center; align-items: center; cursor: pointer; transition: background-color 0.3s ease; }
  #Cart-{{ section.id }} .cart-discount__button:hover { background-color: var(--accent-color-dark); }
  #Cart-{{ section.id }} .cart-discount__message { font-size: 0.9rem; margin-top: 8px; }

  /* Champ de Note Automatisé */
  #Cart-{{ section.id }} .cart-notes { margin: 24px 0; }
  #Cart-{{ section.id }} .cart-notes label { display: block; font-weight: 600; margin-bottom: 8px; font-size: 0.95rem; }
  #Cart-{{ section.id }} .cart-notes__input { width: 100%; min-height: 80px; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; resize: vertical; font-size: 1rem; }

  /* Styles Généraux */
  #Cart-{{ section.id }} .cart__header { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 1.5rem; border-bottom: 1px solid var(--border-color); padding-bottom: 1rem; }
  #Cart-{{ section.id }} .cart__title { font-family: var(--font-heading); font-size: clamp(1.8rem, 5vw, 2.5rem); letter-spacing: 1px; text-transform: uppercase; margin: 0; }
  #Cart-{{ section.id }} .cart__continue-shopping { font-weight: 600; text-decoration: underline; color: var(--text-color); white-space: nowrap; font-size: 0.9rem; }
  #Cart-{{ section.id }} .cart__grid { display: grid; grid-template-columns: 1fr; gap: 32px; }
  #Cart-{{ section.id }} .cart-shipping-bar { margin-bottom: 1.5rem; }
  #Cart-{{ section.id }} .cart-shipping-bar__text { font-weight: 600; margin: 0 0 8px; font-size: 0.95rem; }
  #Cart-{{ section.id }} .cart-shipping-bar__progress-bg { width: 100%; height: 8px; background-color: var(--border-color); border-radius: 4px; overflow: hidden; }
  #Cart-{{ section.id }} .cart-shipping-bar__progress { height: 100%; background-color: var(--accent-color); border-radius: 4px; transition: width 0.5s ease; }
  #Cart-{{ section.id }} .cart-summary { background-color: #f9fafb; border-radius: 16px; padding: 20px; border: 1px solid var(--border-color); }
  #Cart-{{ section.id }} .cart-items__header { display: none; }
  #Cart-{{ section.id }} .cart-item { display: grid; grid-template-columns: 80px 1fr; gap: 16px; padding: 16px 0; border-bottom: 1px solid var(--border-color); }
  #Cart-{{ section.id }} .cart-item:last-child { border-bottom: none; }
  #Cart-{{ section.id }} .cart-item__image-wrapper { border-radius: 12px; overflow: hidden; aspect-ratio: 1 / 1; }
  #Cart-{{ section.id }} .cart-item__image-wrapper img { width: 100%; height: 100%; object-fit: cover; }
  #Cart-{{ section.id }} .cart-item__details { display: flex; flex-direction: column; justify-content: center; gap: 4px; }
  #Cart-{{ section.id }} .cart-item__title-wrapper { display: flex; justify-content: space-between; align-items: flex-start; gap: 8px; }
  #Cart-{{ section.id }} .cart-item__title { font-family: var(--font-heading); font-size: 1.1rem; text-decoration: none; color: var(--text-color); line-height: 1.2; flex-grow: 1; }
  #Cart-{{ section.id }} .cart-item__variant { font-size: 0.85rem; opacity: 0.7; }
  #Cart-{{ section.id }} .cart-item__details-bottom { display: flex; justify-content: space-between; align-items: center; margin-top: 8px; }
  #Cart-{{ section.id }} .cart-item__price--mobile { font-weight: 700; font-size: 1.1rem; }
  #Cart-{{ section.id }} .cart-item__quantity, #Cart-{{ section.id }} .cart-item__line-price, #Cart-{{ section.id }} .cart-item__remove--desktop { display: none; } 
  #Cart-{{ section.id }} .cart-item__remove--mobile { display: block; flex-shrink: 0; }
  #Cart-{{ section.id }} .cart-item__remove { background: none; border: none; cursor: pointer; padding: 0; }
  #Cart-{{ section.id }} .cart-item__remove svg { color: var(--text-color); opacity: 0.6; transition: all 0.2s ease-in-out; }
  #Cart-{{ section.id }} .cart-item__remove:hover svg { color: var(--accent-color); opacity: 1; }
  #Cart-{{ section.id }} .cart__quantity-selector { display: flex; align-items: center; border: 1px solid var(--border-color); border-radius: 20px; width: fit-content; }
  #Cart-{{ section.id }} .cart__quantity-button { background: none; border: none; padding: 4px 10px; cursor: pointer; font-size: 1.1rem; font-weight: 600; color: var(--text-color); }
  #Cart-{{ section.id }} .cart__quantity-input { width: 30px; text-align: center; border: none; background: transparent; font-size: 1rem; font-weight: 600; }
  #Cart-{{ section.id }} .cart-summary__title { font-family: var(--font-heading); font-size: 1.6rem; margin: 0 0 20px; }
  #Cart-{{ section.id }} .cart-summary__row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; font-size: 0.95rem; }
  #Cart-{{ section.id }} .cart-summary__row--discount { color: var(--accent-color); font-weight: 600; }
  #Cart-{{ section.id }} .cart-summary__divider { height: 1px; background-color: var(--border-color); margin: 16px 0; }
  #Cart-{{ section.id }} .cart-summary__row--total { font-size: 1.2rem; }
  #Cart-{{ section.id }} .cart-summary__buttons { display: flex; flex-direction: column; gap: 12px; margin-top: 24px; }
  #Cart-{{ section.id }} .cart__dynamic-checkout { margin-top: 12px; }
  #Cart-{{ section.id }} .cart__dynamic-checkout .shopify-payment-button__button { border-radius: 8px !important; }
  #Cart-{{ section.id }} .cart-summary__secure-info { display: flex; align-items: center; justify-content: center; gap: 8px; margin-top: 16px; opacity: 0.7; font-size: 0.9rem; }
  
  /* Responsive */
  @media (max-width: 480px) {
    #Cart-{{ section.id }} .cart__button--primary { font-size: 1rem; padding: 14px 20px; }
    #Cart-{{ section.id }} .cart-empty__title { font-size: 2rem; }
  }

  @media (min-width: 992px) {
    #Cart-{{ section.id }} .cart__container { padding: 40px; }
    #Cart-{{ section.id }} .cart__grid { grid-template-columns: 1fr 420px; align-items: flex-start; }
    #Cart-{{ section.id }} .cart__summary-column { position: sticky; top: 120px; }
    #Cart-{{ section.id }} .cart-items__header { display: grid; grid-template-columns: 1fr 150px 120px 40px; gap: 20px; padding: 0 0 10px; border-bottom: 1px solid var(--border-color); margin-bottom: 10px; font-weight: 600; opacity: 0.7; }
    #Cart-{{ section.id }} .cart-items__header-label:nth-child(1) { grid-column: 1 / 3; }
    #Cart-{{ section.id }} .cart-items__header-label--center { text-align: center; }
    #Cart-{{ section.id }} .cart-items__header-label--right { text-align: right; }
    #Cart-{{ section.id }} .cart-item { grid-template-columns: 100px 1fr 150px 120px 40px; align-items: center; }
    #Cart-{{ section.id }} .cart-item__image-wrapper { aspect-ratio: 4 / 5; }
    #Cart-{{ section.id }} .cart-item__price--mobile, #Cart-{{ section.id }} .cart-item__quantity-selector--mobile, #Cart-{{ section.id }} .cart-item__remove--mobile { display: none; }
    #Cart-{{ section.id }} .cart-item__details { justify-content: flex-start; }
    #Cart-{{ section.id }} .cart-item__details-bottom { display: none; }
    #Cart-{{ section.id }} .cart-item__quantity { display: flex; justify-content: center; }
    #Cart-{{ section.id }} .cart-item__line-price { display: flex; flex-direction: column; align-items: flex-end; font-weight: 600; text-align: right; }
    #Cart-{{ section.id }} .cart-item__original-price { font-weight: 400; text-decoration: line-through; opacity: 0.7; }
    #Cart-{{ section.id }} .cart-item__remove--desktop { display: flex; align-items: center; justify-content: flex-end; }
  }
</style>

{% schema %}
{
  "name": "Panier",
  "class": "cart-section-wrapper",
  "settings": [
    { "type": "header", "content": "Couleurs" },
    { "type": "color", "id": "accent_color", "label": "Couleur d'accentuation", "default": "#C1272D" },
    { "type": "color", "id": "background_color", "label": "Couleur de fond", "default": "#FFFFFF" },
    { "type": "color", "id": "text_color", "label": "Couleur du texte", "default": "#1A1B18" },
    { "type": "header", "content": "Fonctionnalités" },
    { "type": "number", "id": "free_shipping_threshold", "label": "Seuil pour la livraison gratuite (€)", "info": "Laissez à 0 pour désactiver.", "default": 50 },
    { "type": "checkbox", "id": "show_discount_field", "label": "Afficher le champ de code de réduction", "default": true },
    { "type": "checkbox", "id": "show_cart_note", "label": "Activer les notes de commande", "default": true },
    { "type": "checkbox", "id": "show_continue_shopping", "label": "Afficher le lien 'Continuer les achats'", "default": true },
    { "type": "checkbox", "id": "hide_payment_badges", "label": "Masquer les badges de paiement dynamique", "default": false, "info": "Cochez pour masquer les boutons Apple Pay, Google Pay, etc., sous le bouton de paiement principal." },
    { "type": "url", "id": "continue_shopping_url", "label": "Lien 'Continuer les achats'", "info": "Lien par défaut : toutes les collections" }
  ]
}
{% endschema %}
