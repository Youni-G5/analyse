<div class="CategoryListSection__Container" 
     style="background-color: {{ section.settings.background_color }}; 
            padding-top: {{ section.settings.margin_top }}px; 
            padding-bottom: {{ section.settings.margin_bottom }}px; 
            padding-left: {{ section.settings.section_padding }}px; 
            padding-right: {{ section.settings.section_padding }}px;"
     data-auto-slide="{{ section.settings.enable_auto_slide }}"
     data-slide-speed="{{ section.settings.auto_slide_speed }}">
  
  <div class="CategoryList__Wrapper">
    {% for block in section.blocks %}
      {% assign collection = collections[block.settings.collection_handle] %}
      {% if collection %}
        <a href="{{ collection.url }}" class="CategoryCard__Container">
          
          <!-- Product Grid -->
          <div class="CategoryCard__ProductGrid">
            {% for product in collection.products limit: 3 %}
              {% if product.featured_image %}
                <div class="CategoryCard__GridImageWrapper">
                  <img alt="{{ product.title }}" 
     class="CategoryCard__GridImage" 
     src="{{ product.featured_image | image_url: width: 400 }}"
     width="400"
     height="{{ product.featured_image.height | times: 400 | divided_by: product.featured_image.width }}"
     loading="lazy">
                </div>
              {% endif %}
            {% endfor %}
          </div>
          
          <!-- Title avec flèche -->
          <div class="CategoryCard__Footer">
            <h3 class="CategoryCard__Title">{{ collection.title }}</h3>
            <span class="CategoryCard__Arrow">›</span>
          </div>
        </a>
      {% endif %}
    {% endfor %}
  </div>
</div>

<style>
  .CategoryListSection__Container {
    display: flex;
    flex-direction: column;
    margin: 0;
    transition: all 0.3s ease;
  }

  .CategoryList__Wrapper {
    display: flex;
    gap: {{ section.settings.card_gap }}px;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    scroll-behavior: smooth;
    width: 100%;
    -webkit-overflow-scrolling: touch;
  }

  .CategoryList__Wrapper::-webkit-scrollbar {
    display: none;
  }

  .CategoryCard__Container {
    flex: 0 0 calc({{ 100 | divided_by: section.settings.cards_per_row }}% - {{ section.settings.card_gap }}px);
    display: flex;
    flex-direction: column;
    text-decoration: none;
    color: {{ section.settings.text_color }};
    border: 1px solid {{ section.settings.border_color }};
    padding: 0;
    background: {{ section.settings.card_background }};
    scroll-snap-align: start;
    transition: border-color 0.3s ease;
    border-radius: 0;
    overflow: hidden;
    min-height: 380px;
  }

  .CategoryCard__Container:hover {
    border-color: {{ section.settings.border_hover_color }};
  }

  .CategoryCard__ProductGrid {
    display: flex;
    flex-direction: row;
    gap: 1px;
    flex-grow: 1;
    height: 260px;
    overflow: hidden;
    position: relative;
    align-items: center;
    justify-content: center;
    padding: 0;
    margin: 0;
    background: transparent;
  }

  .CategoryCard__GridImageWrapper {
    flex: 0 0 120px;
    width: 120px;
    height: 120px;
    opacity: 1;
    filter: none;
    border-radius: 0;
    position: relative;
    margin: 0;
    padding: 0;
    background: transparent;
    border: none;
    overflow: hidden;
  }

  .CategoryCard__GridImage {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center;
    display: block;
    transition: none;
    background: transparent;
  }

  .CategoryCard__Footer {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 15px;
    background: {{ section.settings.card_background }};
  }

  .CategoryCard__Title {
    margin: 0;
    font-size: 13px;
    font-weight: 500;
    letter-spacing: 0.5px;
    flex: 1;
  }

  .CategoryCard__Arrow {
    font-size: 18px;
    margin-left: 8px;
    opacity: 0.7;
    transition: none;
  }

  .CategoryCard__Container:hover .CategoryCard__Arrow {
    opacity: 1;
    transform: translateX(4px);
    transition: all 0.3s ease;
  }

  /* TABLET - 768px à 1023px */
  @media (max-width: 1023px) and (min-width: 769px) {
    .CategoryCard__Container {
      flex: 0 0 calc(50% - 8px);
      min-height: 360px;
    }

    .CategoryCard__ProductGrid {
      height: 200px;
    }

    .CategoryCard__GridImageWrapper {
      flex: 0 0 100px;
      width: 100px;
      height: 100px;
    }
  }

  /* MOBILE - 480px à 768px */
  @media (max-width: 768px) {
    .CategoryList__Wrapper {
      scroll-snap-type: x mandatory;
      gap: 16px;
      scroll-padding: 0 20px;
    }

    .CategoryCard__Container {
      flex: 0 0 calc(100% - 40px);
      min-height: 380px;
    }

    .CategoryCard__ProductGrid {
      height: 240px;
      overflow: visible;
    }

    .CategoryCard__GridImageWrapper {
      flex: 0 0 140px;
      width: 140px;
      height: 140px;
    }

    .CategoryCard__Title {
      font-size: 13px;
    }
  }

  /* TRÈS MOBILE - moins de 480px */
  @media (max-width: 480px) {
    .CategoryListSection__Container {
      padding-left: 12px !important;
      padding-right: 12px !important;
    }

    .CategoryList__Wrapper {
      gap: 16px;
      scroll-padding: 0 12px;
    }

    .CategoryCard__Container {
      flex: 0 0 calc(100% - 24px);
      min-height: 360px;
    }

    .CategoryCard__ProductGrid {
      height: 220px;
      overflow: visible;
    }

    .CategoryCard__GridImageWrapper {
      flex: 0 0 130px;
      width: 130px;
      height: 130px;
    }

    .CategoryCard__Title {
      font-size: 12px;
    }

    .CategoryCard__Footer {
      padding: 12px 15px;
    }
  }

  /* DESKTOP - 1024px et plus - IMAGES AGRANDIES */
  @media (min-width: 1024px) {
    .CategoryCard__Container {
      min-height: 380px;
    }

    .CategoryCard__ProductGrid {
      height: 260px;
    }

    .CategoryCard__GridImageWrapper {
      flex: 0 0 160px;
      width: 160px;
      height: 160px;
    }
  }

  /* DESKTOP XL - 1400px et plus */
  @media (min-width: 1400px) {
    .CategoryCard__Container {
      min-height: 400px;
    }

    .CategoryCard__ProductGrid {
      height: 280px;
    }

    .CategoryCard__GridImageWrapper {
      flex: 0 0 170px;
      width: 170px;
      height: 170px;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const containers = document.querySelectorAll('[data-auto-slide="true"]');
    
    containers.forEach(container => {
      const wrapper = container.querySelector('.CategoryList__Wrapper');
      const cards = container.querySelectorAll('.CategoryCard__Container');
      const speed = parseInt(container.dataset.slideSpeed) || 3000;
      
      if (!wrapper || cards.length === 0) return;
      
      // Auto-slide uniquement en mobile
      if (window.innerWidth <= 768) {
        let currentIndex = 0;
        let autoSlideInterval;
        
        function autoSlide() {
          currentIndex = (currentIndex + 1) % cards.length;
          const cardWidth = cards[0].offsetWidth + 16;
          wrapper.scrollTo({
            left: currentIndex * cardWidth,
            behavior: 'smooth'
          });
        }
        
        // Démarrer l'auto-slide
        autoSlideInterval = setInterval(autoSlide, speed);
        
        // Pause au toucher
        wrapper.addEventListener('touchstart', () => {
          clearInterval(autoSlideInterval);
        });
        
        // Reprendre après le toucher
        wrapper.addEventListener('touchend', () => {
          autoSlideInterval = setInterval(autoSlide, speed);
        });
      }
    });
  });
</script>

{% schema %}
{
  "name": "Collections Concept",
  "settings": [
    {
      "type": "range",
      "id": "cards_per_row",
      "label": "Cards per Row",
      "min": 2,
      "max": 5,
      "step": 1,
      "default": 4
    },
    {
      "type": "range",
      "id": "card_gap",
      "label": "Gap Between Cards",
      "min": 10,
      "max": 40,
      "step": 5,
      "default": 20,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "section_padding",
      "label": "Section Padding (Left/Right)",
      "min": 0,
      "max": 80,
      "step": 10,
      "default": 30,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "margin_top",
      "label": "Margin Top",
      "min": 0,
      "max": 100,
      "step": 10,
      "default": 30,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "margin_bottom",
      "label": "Margin Bottom",
      "min": 0,
      "max": 100,
      "step": 10,
      "default": 30,
      "unit": "px"
    },
    {
      "type": "checkbox",
      "id": "enable_auto_slide",
      "label": "Enable Auto Slide (Mobile Only)",
      "default": false,
      "info": "Cards will automatically slide on mobile devices"
    },
    {
      "type": "range",
      "id": "auto_slide_speed",
      "label": "Auto Slide Speed",
      "min": 2000,
      "max": 8000,
      "step": 500,
      "default": 3000,
      "unit": "ms",
      "info": "Time between slides (milliseconds)"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "card_background",
      "label": "Card Background",
      "default": "#0a0a0a"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color",
      "default": "#FFFFFF"
    },
    {
      "type": "color",
      "id": "border_color",
      "label": "Border Color",
      "default": "#333333"
    },
    {
      "type": "color",
      "id": "border_hover_color",
      "label": "Border Hover",
      "default": "#666666"
    }
  ],
  "blocks": [
    {
      "type": "collection",
      "name": "Collection Card",
      "settings": [
        {
          "type": "collection",
          "id": "collection_handle",
          "label": "Select Collection"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Collections Concept",
      "category": "Produit",
      "blocks": [
        { "type": "collection" },
        { "type": "collection" },
        { "type": "collection" },
        { "type": "collection" }
      ]
    }
  ]
}
{% endschema %}
