{% comment %}
  Template: Customer Addresses
  Description: Gestion des adresses client (ajout, modification, suppression)
{% endcomment %}

{%- paginate customer.addresses by 5 -%}
  <div class="customer addresses page-width">
    <div class="addresses-header">
      <a href="{{ routes.account_url }}" class="link link--back">
        <svg width="10" height="10" viewBox="0 0 10 10" fill="none">
          <path d="M8 1L2 5L8 9" stroke="currentColor" stroke-width="1.5"/>
        </svg>
        {{ 'customer.account.return' | t }}
      </a>
      
      <h1 class="customer-title">{{ 'customer.addresses.title' | t }}</h1>
    </div>

    <button type="button" class="button button--primary" onclick="toggleAddressForm('AddAddress')">
      {{ 'customer.addresses.add_new' | t }}
    </button>

    {%- comment -%} Formulaire d'ajout de nouvelle adresse {%- endcomment -%}
    <div id="AddAddress" class="address-form" style="display: none;">
      <h2>{{ 'customer.addresses.add_new' | t }}</h2>
      
      {%- form 'customer_address', customer.new_address -%}
        <div class="form-grid">
          <div class="field">
            <input
              type="text"
              name="address[first_name]"
              id="AddressFirstNameNew"
              value="{{ form.first_name }}"
              autocomplete="given-name"
              placeholder="{{ 'customer.addresses.first_name' | t }}"
            >
            <label for="AddressFirstNameNew">{{ 'customer.addresses.first_name' | t }}</label>
          </div>

          <div class="field">
            <input
              type="text"
              name="address[last_name]"
              id="AddressLastNameNew"
              value="{{ form.last_name }}"
              autocomplete="family-name"
              placeholder="{{ 'customer.addresses.last_name' | t }}"
            >
            <label for="AddressLastNameNew">{{ 'customer.addresses.last_name' | t }}</label>
          </div>
        </div>

        <div class="field">
          <input
            type="text"
            name="address[company]"
            id="AddressCompanyNew"
            value="{{ form.company }}"
            autocomplete="organization"
            placeholder="{{ 'customer.addresses.company' | t }}"
          >
          <label for="AddressCompanyNew">{{ 'customer.addresses.company' | t }}</label>
        </div>

        <div class="field">
          <input
            type="text"
            name="address[address1]"
            id="AddressAddress1New"
            value="{{ form.address1 }}"
            autocomplete="address-line1"
            placeholder="{{ 'customer.addresses.address1' | t }}"
          >
          <label for="AddressAddress1New">{{ 'customer.addresses.address1' | t }}</label>
        </div>

        <div class="field">
          <input
            type="text"
            name="address[address2]"
            id="AddressAddress2New"
            value="{{ form.address2 }}"
            autocomplete="address-line2"
            placeholder="{{ 'customer.addresses.address2' | t }}"
          >
          <label for="AddressAddress2New">{{ 'customer.addresses.address2' | t }}</label>
        </div>

        <div class="form-grid">
          <div class="field">
            <input
              type="text"
              name="address[city]"
              id="AddressCityNew"
              value="{{ form.city }}"
              autocomplete="address-level2"
              placeholder="{{ 'customer.addresses.city' | t }}"
            >
            <label for="AddressCityNew">{{ 'customer.addresses.city' | t }}</label>
          </div>

          <div class="field">
            <select
              name="address[country]"
              id="AddressCountryNew"
              autocomplete="country"
              onchange="updateProvinceSelectNew(this.value)"
            >
              {{ all_country_option_tags }}
            </select>
            <label for="AddressCountryNew">{{ 'customer.addresses.country' | t }}</label>
          </div>
        </div>

        <div class="form-grid">
          <div class="field">
            <select
              name="address[province]"
              id="AddressProvinceNew"
              autocomplete="address-level1"
            >
            </select>
            <label for="AddressProvinceNew">{{ 'customer.addresses.province' | t }}</label>
          </div>

          <div class="field">
            <input
              type="text"
              name="address[zip]"
              id="AddressZipNew"
              value="{{ form.zip }}"
              autocomplete="postal-code"
              placeholder="{{ 'customer.addresses.zip' | t }}"
            >
            <label for="AddressZipNew">{{ 'customer.addresses.zip' | t }}</label>
          </div>
        </div>

        <div class="field">
          <input
            type="tel"
            name="address[phone]"
            id="AddressPhoneNew"
            value="{{ form.phone }}"
            autocomplete="tel"
            placeholder="{{ 'customer.addresses.phone' | t }}"
          >
          <label for="AddressPhoneNew">{{ 'customer.addresses.phone' | t }}</label>
        </div>

        <div class="form-actions">
          <button type="submit" class="button button--primary">{{ 'customer.addresses.add' | t }}</button>
          <button type="button" class="button button--secondary" onclick="toggleAddressForm('AddAddress')">{{ 'customer.addresses.cancel' | t }}</button>
        </div>
      {%- endform -%}
    </div>

    {%- comment -%} Liste des adresses existantes {%- endcomment -%}
    <div class="addresses-list">
      {%- for address in customer.addresses -%}
        <div class="address-card" data-address-id="{{ address.id }}">
          {%- if address == customer.default_address -%}
            <span class="address-badge">{{ 'customer.addresses.default' | t }}</span>
          {%- endif -%}
          
          <div class="address-content">
            {{ address | format_address }}
          </div>

          <div class="address-actions">
            <button type="button" class="link" onclick="toggleAddressForm('EditAddress_{{ address.id }}')">
              {{ 'customer.addresses.edit' | t }}
            </button>
            <button type="button" class="link" onclick="deleteAddress({{ address.id }})">
              {{ 'customer.addresses.delete' | t }}
            </button>
            {%- if address != customer.default_address -%}
              {%- form 'customer_address', address -%}
                <input type="hidden" name="_method" value="put">
                <input type="hidden" name="address[default]" value="true">
                <button type="submit" class="link">{{ 'customer.addresses.set_default' | t }}</button>
              {%- endform -%}
            {%- endif -%}
          </div>

          {%- comment -%} Formulaire d'édition {%- endcomment -%}
          <div id="EditAddress_{{ address.id }}" class="address-form" style="display: none;">
            <h3>{{ 'customer.addresses.edit_address' | t }}</h3>
            
            {%- form 'customer_address', address -%}
              <input type="hidden" name="_method" value="put">
              
              {%- comment -%} Mêmes champs que le formulaire d'ajout {%- endcomment -%}
              <div class="form-grid">
                <div class="field">
                  <input type="text" name="address[first_name]" value="{{ address.first_name }}" autocomplete="given-name" placeholder="{{ 'customer.addresses.first_name' | t }}">
                  <label>{{ 'customer.addresses.first_name' | t }}</label>
                </div>
                <div class="field">
                  <input type="text" name="address[last_name]" value="{{ address.last_name }}" autocomplete="family-name" placeholder="{{ 'customer.addresses.last_name' | t }}">
                  <label>{{ 'customer.addresses.last_name' | t }}</label>
                </div>
              </div>
              
              <div class="field">
                <input type="text" name="address[company]" value="{{ address.company }}" autocomplete="organization" placeholder="{{ 'customer.addresses.company' | t }}">
                <label>{{ 'customer.addresses.company' | t }}</label>
              </div>
              
              <div class="field">
                <input type="text" name="address[address1]" value="{{ address.address1 }}" autocomplete="address-line1" placeholder="{{ 'customer.addresses.address1' | t }}">
                <label>{{ 'customer.addresses.address1' | t }}</label>
              </div>
              
              <div class="field">
                <input type="text" name="address[address2]" value="{{ address.address2 }}" autocomplete="address-line2" placeholder="{{ 'customer.addresses.address2' | t }}">
                <label>{{ 'customer.addresses.address2' | t }}</label>
              </div>
              
              <div class="form-grid">
                <div class="field">
                  <input type="text" name="address[city]" value="{{ address.city }}" autocomplete="address-level2" placeholder="{{ 'customer.addresses.city' | t }}">
                  <label>{{ 'customer.addresses.city' | t }}</label>
                </div>
                <div class="field">
                  <select name="address[country]" autocomplete="country">
                    {{ country_option_tags }}
                  </select>
                </div>
              </div>
              
              <div class="form-grid">
                <div class="field">
                  <select name="address[province]" autocomplete="address-level1">
                    {{ address.province }}
                  </select>
                </div>
                <div class="field">
                  <input type="text" name="address[zip]" value="{{ address.zip }}" autocomplete="postal-code" placeholder="{{ 'customer.addresses.zip' | t }}">
                  <label>{{ 'customer.addresses.zip' | t }}</label>
                </div>
              </div>
              
              <div class="field">
                <input type="tel" name="address[phone]" value="{{ address.phone }}" autocomplete="tel" placeholder="{{ 'customer.addresses.phone' | t }}">
                <label>{{ 'customer.addresses.phone' | t }}</label>
              </div>

              <div class="form-actions">
                <button type="submit" class="button button--primary">{{ 'customer.addresses.update' | t }}</button>
                <button type="button" class="button button--secondary" onclick="toggleAddressForm('EditAddress_{{ address.id }}')">{{ 'customer.addresses.cancel' | t }}</button>
              </div>
            {%- endform -%}
          </div>
        </div>
      {%- endfor -%}
    </div>

    {%- if paginate.pages > 1 -%}
      {% render 'pagination', paginate: paginate %}
    {%- endif -%}
  </div>
{%- endpaginate -%}

<script>
  function toggleAddressForm(formId) {
    const form = document.getElementById(formId);
    if (form) {
      form.style.display = form.style.display === 'none' ? 'block' : 'none';
    }
  }

  function deleteAddress(addressId) {
    if (confirm('{{ 'customer.addresses.delete_confirm' | t }}')) {
      const form = document.createElement('form');
      form.method = 'post';
      form.action = '/account/addresses/' + addressId;
      
      const methodInput = document.createElement('input');
      methodInput.type = 'hidden';
      methodInput.name = '_method';
      methodInput.value = 'delete';
      form.appendChild(methodInput);
      
      document.body.appendChild(form);
      form.submit();
    }
  }
</script>

<style>
  .customer.addresses {
    padding: 60px 20px;
  }

  .addresses-header {
    margin-bottom: 32px;
  }

  .link--back {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 16px;
    color: rgb(var(--foreground-color));
    text-decoration: none;
  }

  .customer-title {
    font-size: 28px;
    font-weight: 600;
  }

  .address-form {
    background: white;
    padding: 32px;
    margin: 24px 0;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  }

  .address-form h2,
  .address-form h3 {
    margin-bottom: 24px;
    font-size: 20px;
    font-weight: 600;
  }

  .form-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
  }

  .field {
    position: relative;
    margin-bottom: 20px;
  }

  .field input,
  .field select {
    width: 100%;
    padding: 12px 16px;
    border: 1px solid rgba(0,0,0,0.15);
    border-radius: 4px;
    font-size: 16px;
  }

  .field label {
    position: absolute;
    left: 16px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 16px;
    color: rgba(0,0,0,0.55);
    pointer-events: none;
    transition: all 0.2s;
  }

  .field input:focus + label,
  .field input:not(:placeholder-shown) + label,
  .field select:focus + label {
    top: -10px;
    font-size: 12px;
    background: white;
    padding: 0 4px;
  }

  .form-actions {
    display: flex;
    gap: 12px;
    margin-top: 24px;
  }

  .button {
    padding: 12px 24px;
    border: none;
    border-radius: 4px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
  }

  .button--primary {
    background: rgb(var(--foreground-color));
    color: rgb(var(--background-color));
  }

  .button--secondary {
    background: transparent;
    color: rgb(var(--foreground-color));
    border: 2px solid rgb(var(--foreground-color));
  }

  .addresses-list {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 24px;
    margin-top: 32px;
  }

  .address-card {
    background: white;
    padding: 24px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    position: relative;
  }

  .address-badge {
    position: absolute;
    top: 12px;
    right: 12px;
    background: rgb(var(--foreground-color));
    color: rgb(var(--background-color));
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 600;
  }

  .address-content {
    margin-bottom: 20px;
    line-height: 1.6;
  }

  .address-actions {
    display: flex;
    gap: 16px;
    flex-wrap: wrap;
  }

  .address-actions .link {
    color: rgb(var(--foreground-color));
    text-decoration: underline;
    background: none;
    border: none;
    padding: 0;
    cursor: pointer;
    font-size: 14px;
  }

  @media (max-width: 768px) {
    .form-grid {
      grid-template-columns: 1fr;
    }

    .addresses-list {
      grid-template-columns: 1fr;
    }
  }
</style>
